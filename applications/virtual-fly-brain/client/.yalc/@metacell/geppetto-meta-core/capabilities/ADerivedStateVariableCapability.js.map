{"version":3,"file":"ADerivedStateVariableCapability.js","names":["capabilityId","watched","timeSeries","inputs","getTimeSeries","step","getVariable","getWrappedObj","normalizationFunction","getTimeSeriesFromInput","inputIndex","inputId","push","ModelFactory","findMatchingInstanceByID","window","Instances","getChildren","inputTimeSeries","undefined","sampleIndex","length","setTimeSeries","getInitialValue","initialValues","getUnit","extractUnit","unit","i","value","eClass","isWatched"],"sources":["../../src/capabilities/ADerivedStateVariableCapability.js"],"sourcesContent":["/**\n * Client class use to augment a model with state variable capabilities\n *\n * @module model/ADerivedStateVariableCapability\n * @author Adrian Quintana\n */\nimport ModelFactory from '../ModelFactory';\n\nexport default {\n  capabilityId: 'DerivedStateVariableCapability',\n  watched: false,\n  timeSeries: null,\n  inputs: null,\n\n  /**\n   * Get value of quantity\n   *\n   * @command Variable.getTimeSeries()\n   * @returns {String} Value of quantity\n   */\n  getTimeSeries: function (step) {\n    if (this.getVariable().getWrappedObj().normalizationFunction == 'SPACEPLOT'){\n      return this.getTimeSeriesFromInput(step);\n    }\n    if (this.getVariable().getWrappedObj().normalizationFunction == 'CONSTANT'){\n      return this.getVariable().getWrappedObj().timeSeries;\n    }\n  },\n\n  getTimeSeriesFromInput: function (step) {\n    var timeSeries = []\n    // FIXME: Remove this once we pass pointers instead of ids\n    if (!this.inputs){\n      this.inputs = []\n      for (var inputIndex in this.getVariable().getWrappedObj().inputs){\n        var inputId = this.getVariable().getWrappedObj().inputs[inputIndex]\n        this.inputs.push(ModelFactory.findMatchingInstanceByID(inputId, window.Instances[0].getChildren()))\n      }\n                \n    }\n            \n    for (var inputIndex in this.inputs){\n      var inputTimeSeries = this.inputs[inputIndex].getTimeSeries();\n      if (inputTimeSeries != undefined){\n        var sampleIndex = step\n        if (step == undefined){\n          sampleIndex = inputTimeSeries.length - 1\n        }\n        timeSeries.push(inputTimeSeries[sampleIndex]);\n      } else {\n        timeSeries.push([])\n      }\n    }\n    return timeSeries;\n  },\n\n\n  /**\n   * Set the time series for the state variable\n   *\n   * @command Variable.setTimeSeries()\n   * @returns {Object} The state variable\n   */\n  setTimeSeries: function (timeSeries) {\n    this.timeSeries = timeSeries;\n    return this;\n  },\n\n  /**\n   * Get the initial value for the state variable\n   *\n   * @command Variable.getInitialValue()\n   * @returns {Object} The initial value of the state variable\n   */\n  getInitialValue: function () {\n    return this.getVariable().getWrappedObj().initialValues;\n  },\n\n  /**\n   * Get the type of tree this is\n   *\n   * @command Variable.getUnit()\n   * @returns {String} Unit for quantity\n   */\n  getUnit: function () {\n    if (!this.timeSeries) {\n      return this.extractUnit();\n    } else {\n      if (this.timeSeries.unit == null || this.timeSeries.unit == undefined){\n        if (this.getVariable() != undefined || this.getVariable() != null){\n          return this.extractUnit();\n        }\n      } else {\n        return this.timeSeries.unit;\n      }\n    }\n  },\n        \n  extractUnit : function (){\n    var unit = undefined;\n    var initialValues = this.getVariable().getWrappedObj().initialValues;\n\n    for (var i = 0; i < initialValues.length; i++) {\n      if (initialValues[i].value.eClass === 'PhysicalQuantity' || initialValues[i].value.eClass === 'TimeSeries') {\n        unit = initialValues[i].value.unit.unit\n      }\n    }\n    return unit;\n  },\n\n  /**\n   * Get watched\n   *\n   * @command Variable.getWatched()\n   * @returns {boolean} true if this variable is being watched\n   */\n  isWatched: function () {\n    // NOTE: this.watched is a flag added by this API / Capability\n    return this.watched;\n  },\n}\n\n"],"mappings":"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"}