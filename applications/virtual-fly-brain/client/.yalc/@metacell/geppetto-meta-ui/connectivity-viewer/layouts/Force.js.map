{"version":3,"file":"Force.js","names":["util","_interopRequireWildcard","require","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","o","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","length","descriptor","enumerable","configurable","writable","_toPropertyKey","key","_createClass","protoProps","staticProps","_toPrimitive","toPrimitive","String","Number","d3","Force","exports","value","draw","context","linkTypeScale","scaleOrdinal","schemeCategory10","domain","dataset","linkTypes","nodeTypeScale","nodeColormap","range","schemeCategory20","weightScale","scaleLinear","extent","pluck","links","map","parseFloat","force","forceSimulation","forceManyBody","strength","forceLink","id","d","index","forceCenter","width","height","g","svg","append","attr","link","selectAll","data","enter","style","type","weight","node","nodes","drag","on","dragstarted","dragged","dragended","text","event","active","alphaTarget","restart","fx","x","fy","y","zoom_handler","zoom","zoom_actions","transform","source","getLegends","colorScale","title","getName","hasTooltip","hasToggle","hasSelect"],"sources":["../../../src/connectivity-viewer/layouts/Force.js"],"sourcesContent":["\n\n// import * as d3 from \"d3\";\nconst d3 = require(\"d3\");\nimport * as util from \"../../utilities\";\n\nexport class Force {\n\n  draw (context) {\n\n    // TODO: 10/20 categories hardcoded in color scales\n    const linkTypeScale = d3.scaleOrdinal(d3.schemeCategory10)\n      .domain(context.dataset.linkTypes);\n    const nodeTypeScale = context.nodeColormap.range ? context.nodeColormap : d3.scaleOrdinal(d3.schemeCategory20);\n    const weightScale = d3.scaleLinear()\n      .domain(d3.extent(util.pluck(context.dataset.links, 'weight').map(parseFloat)))\n    // TODO: think about weight = 0 (do we draw a line?)\n      .range([0.5, 4]);\n\n    context.force = d3.forceSimulation()\n      .force(\"charge\", d3.forceManyBody().strength(-250))\n      .force(\"link\", d3.forceLink().id(function (d) {\n        return d.index;\n      }))\n      .force(\"center\", d3.forceCenter(context.width / 2, context.height / 2));\n\n    // add encompassing group for the zoom\n    const g = context.svg.append(\"g\")\n      .attr(\"class\", \"everything\");\n\n    const link = g.selectAll(\".link\")\n      .data(context.dataset.links)\n      .enter().append(\"line\")\n      .attr(\"class\", \"link\")\n      .style(\"stroke\", function (d) {\n        return linkTypeScale(d.type)\n      })\n      .style(\"stroke-width\", function (d) {\n        return weightScale(d.weight)\n      });\n\n    const node = g.selectAll(\".node\")\n      .data(context.dataset.nodes)\n      .enter().append(\"circle\")\n      .attr(\"class\", \"node\")\n      .attr(\"r\", 5) // radius\n      .style(\"fill\", function (d) {\n        return nodeTypeScale(d.type);\n      })\n      .call(d3.drag()\n        .on(\"start\", dragstarted)\n        .on(\"drag\", dragged)\n        .on(\"end\", dragended));\n\n    node.append(\"title\")\n      .text(function (d) {\n        return d.id;\n      });\n\n    function dragstarted (d) {\n      if (!d3.event.active) {\n        context.force.alphaTarget(0.3).restart();\n      }\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n\n    function dragged (d) {\n      d.fx = d3.event.x;\n      d.fy = d3.event.y;\n    }\n\n    function dragended (d) {\n      if (!d3.event.active) {\n        context.force.alphaTarget(0);\n      }\n      d.fx = null;\n      d.fy = null;\n    }\n\n    const zoom_handler = d3.zoom()\n      .on(\"zoom\", zoom_actions);\n\n    function zoom_actions (){\n      g.attr(\"transform\", d3.event.transform);\n    }\n    zoom_handler(context.svg);\n    \n    context.force.nodes(context.dataset.nodes).on(\"tick\", function () {\n      link.attr(\"x1\", function (d) {\n        return d.source.x;\n      })\n        .attr(\"y1\", function (d) {\n          return d.source.y;\n        })\n        .attr(\"x2\", function (d) {\n          return d.target.x;\n        })\n        .attr(\"y2\", function (d) {\n          return d.target.y;\n        });\n\n      node.attr(\"cx\", function (d) {\n        return d.x;\n      })\n        .attr(\"cy\", function (d) {\n          return d.y;\n        });\n    });\n    context.force.force(\"link\").links(context.dataset.links);\n  }\n\n  getLegends (context){\n    const nodeTypeScale = context.nodeColormap.range ? context.nodeColormap : d3.scaleOrdinal(d3.schemeCategory20);\n    const linkTypeScale = d3.scaleOrdinal(d3.schemeCategory10)\n      .domain(context.dataset.linkTypes);\n    return [\n      { id:'legend', colorScale:nodeTypeScale, title:'Cell Types' },\n      { id:'legend2', colorScale:linkTypeScale, title:'Synapse Types' }\n    ];\n  }\n\n  getName (){\n    return \"Force\"\n  }\n\n  hasTooltip (){\n    return false\n  }\n\n  hasToggle (){\n    return true\n  }\n\n  hasSelect (){\n    return false\n  }\n}\n"],"mappings":"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","ignoreList":[]}