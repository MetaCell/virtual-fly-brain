{"version":3,"file":"GeppettoJupyterUtils.js","names":["handle_output","data","msg_type","console","log","content","evalue","trim","error","traceback","EventManager","actionsHandler","clientActions","ERROR_WHILE_EXEC_PYTHON_COMMAND","HIDE_SPINNER","response","JSON","parse","replace","RECEIVE_PYTHON_MESSAGE","id","parent_header","msg_id","type","text","execPythonMessage","command","callback","kernel","IPython","notebook","messageID","execute","iopub","output","silent","stop_on_error","store_history","Promise","resolve","reject","eventsCallback","add","action","evalPythonMessage","parameters","parametersString","length","map","parameter","stringify","join","finalCommand"],"sources":["../../../src/communication/geppettoJupyter/GeppettoJupyterUtils.js"],"sourcesContent":["import EventManager from '@metacell/geppetto-meta-client/common/EventManager';\n\nconst handle_output = function (data) {\n  // data is the object passed to the callback from the kernel execution\n  switch (data.msg_type) {\n  case 'error':\n    console.log(\"ERROR while executing a Python command:\");\n    console.log(data.content.evalue.trim());\n    console.error(\"ERROR while executing a Python command:\");\n    console.error(data.content.traceback);\n    EventManager.actionsHandler[EventManager.clientActions.ERROR_WHILE_EXEC_PYTHON_COMMAND](data.content);\n    EventManager.actionsHandler[EventManager.clientActions.HIDE_SPINNER]();\n    break;\n  case 'execute_result':\n    console.log(data.content.data['text/plain'].trim(), true);\n    try {\n      var response = JSON.parse(data.content.data['text/plain'].replace(/^'(.*)'$/, '$1'));\n    } catch (error) {\n      var response = data.content.data['text/plain'].replace(/^'(.*)'$/, '$1');\n    }\n    EventManager.actionsHandler[EventManager.clientActions.RECEIVE_PYTHON_MESSAGE]({\n      id: data.parent_header.msg_id,\n      type: data.msg_type,\n      response: response\n    });\n    break;\n  case \"display_data\":\n    // FIXME\n    break;\n  default:\n    console.log(data.content.text.trim(), true);\n  }\n};\n\nconst execPythonMessage = function (command, callback = handle_output) {\n  console.log('Executing Python command: ' + command, true);\n  var kernel = IPython.notebook.kernel;\n  var messageID = kernel.execute(command, { iopub: { output: callback } }, { silent: false, stop_on_error: true, store_history: true });\n\n  return new Promise((resolve, reject) =>\n    EventManager.eventsCallback[EventManager.clientActions.RECEIVE_PYTHON_MESSAGE].add(action => {\n      if (action.data.id == messageID) {\n        resolve(action.data.response);\n      }\n    })\n  );\n};\n\nconst evalPythonMessage = function (command, parameters, parse = true) {\n  var parametersString = '';\n  if (parameters) {\n    if (parameters.length > 0) {\n      parametersString = \"(\" + parameters.map(parameter => \"utils.convertToPython('\" + JSON.stringify(parameter) + \"')\").join(\",\") + \")\";\n    } else {\n      parametersString = '()';\n    }\n  }\n\n  var finalCommand = command + parametersString;\n  if (parse) {\n    finalCommand = 'utils.convertToJS(' + finalCommand + ')'\n  }\n  return execPythonMessage(finalCommand, handle_output);\n\n};\n\nexport { execPythonMessage, evalPythonMessage }\n"],"mappings":"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"}