{"version":3,"file":"Matrix.js","names":["d3","require","Matrix","exports","_classCallCheck","leftIndicator","topIndicator","order","_createClass","key","value","draw","context","matrixDim","height","width","x","scaleBand","range","z","scaleLinear","domain","clamp","c","scaleOrdinal","schemeCategory10","defaultTooltipText","container","svg","append","attr","matrix","nodes","dataset","root","n","length","forEach","node","i","pre_count","post_count","map","j","y","links","link","source","target","type","sortOptions","orders","id","sort","a","b","ascending","pre","conn","filter","d","matrixT","col","row","post","popNameFromId","eval","props","modelFactory","getAllPotentialInstancesEndingWith","getParent","getName","mouseoverCell","msg","select","parentNode","appendChild","transition","duration","style","tooltipRef","current","setState","layoutTooltip","mouseoutCell","popIndicator","pos","colormap","w","h","selectAll","data","enter","on","apply","rect","nodeColormap","schemeCategory20","postMargin","parseInt","preMargin","postPop","each","prePop","row_","column","cell","bandwidth","matrixOnClickHandler","getLegends","colorScale","title","setOrder","t","delay","hasTooltip","hasToggle","hasSelect"],"sources":["../../../src/connectivity-viewer/layouts/Matrix.js"],"sourcesContent":["const d3 = require(\"d3\");\n\nexport class Matrix {\n  constructor () {\n    this.leftIndicator = 10;\n    this.topIndicator = 10;\n    this.order = \"id\";\n  }\n  \n  draw (context) {\n    \n    const matrixDim\n        = context.height < context.width\n          ? context.height\n          : context.width;\n\n    const x = d3.scaleBand().range([0, matrixDim]);\n    // Opacity\n    const z = d3.scaleLinear().domain([0, 4]).clamp(true);\n    // Colors\n    const c = d3.scaleOrdinal(d3.schemeCategory10);\n\n    const defaultTooltipText = \"Hover the squares to see the connections.\";\n\n    const container = context.svg\n      .append(\"g\")\n      .attr(\"transform\", \"translate(\" + this.leftIndicator + \",\" + this.topIndicator + \")\");\n\n\n    const matrix = [];\n    const nodes = context.dataset.nodes;\n    const root = context.dataset.root;\n    const n = nodes.length;\n\n    // Compute index per node.\n    nodes.forEach(function (node, i) {\n      node.pre_count = 0;\n      node.post_count = 0;\n      matrix[i] = d3.range(n).map(function (j) {\n        return { x: j, y: i, z: 0 };\n      });\n    });\n\n    // Convert links to matrix; count pre / post conns.\n    context.dataset.links.forEach(function (link) {\n      /*\n       * TODO: think about zero weight lines\n       * matrix[link.source][link.target].z = link.weight ? link.type : 0;\n       */\n      matrix[link.source][link.target].z = link.type;\n      nodes[link.source].pre_count += 1;\n      nodes[link.target].post_count += 1;\n    });\n\n    /*\n     * Sorting matrix entries.\n     * TODO: runtime specified sorting criteria\n     */\n    const sortOptions = {\n      'id': 'By entity name',\n      'pre_count': 'By # pre',\n      'post_count': 'By # post'\n    };\n    //  Precompute the orders.\n    this.orders = {\n      id: d3.range(n).sort(function (a, b) {\n        return d3.ascending(nodes[a].id, nodes[b].id);\n      }),\n      pre_count: d3.range(n).sort(function (a, b) {\n        return nodes[b].pre_count - nodes[a].pre_count;\n      }),\n      post_count: d3.range(n).sort(function (a, b) {\n        return nodes[b].post_count - nodes[a].post_count;\n      }),\n      // community: d3.range(n).sort(function(a, b) { return nodes[b].community - nodes[a].community; }),\n    };\n    // Default sort order.\n    x.domain(this.orders[this.order]);\n\n    /*\n     * we store the 'conn' key in case we want to\n     * eg. conditionally colour the indicator if there\n     * are actually connections in that row/column\n     */\n    const pre = nodes.map(function (x, i) {\n      return {\n        id: x.id, conn: matrix[i].filter(function (d) {\n          return d.z;\n        }).length > 0\n      }\n    });\n    const matrixT = matrix[0].map(function (col, i) {\n      return matrix.map(function (row) {\n        return row[i];\n      })\n    });\n    const post = nodes.map(function (x, i) {\n      return {\n        id: x.id, conn: matrixT[i].filter(function (d) {\n          return d.z;\n        }).length > 0\n      }\n    });\n\n    const popNameFromId = function (id) {\n      return eval(context.props.modelFactory.getAllPotentialInstancesEndingWith(id)[0]).getParent().getName();\n    };\n\n    const mouseoverCell = function (msg) {\n      d3.select(this.parentNode.appendChild(this)).transition().duration(100).style('stroke-opacity', 1).style('stroke', 'white').style('stroke-width', 2);\n      d3.select(\"body\").style('cursor', 'pointer');\n      if (context.tooltipRef.current){\n        context.tooltipRef.current.setState(() => ({ layoutTooltip: msg }));\n      }\n    };\n\n    const mouseoutCell = function () {\n      d3.select(this).transition().duration(100).style('stroke-opacity', 0).style('stroke', 'white');\n      d3.select(\"body\").style('cursor', 'default');\n      if (context.tooltipRef.current){\n        context.tooltipRef.current.setState(() => ({ layoutTooltip: defaultTooltipText }));\n      }\n    };\n\n    const popIndicator = function (pos, colormap, w, h) {\n      return function (d, i) {\n        d3.select(this).selectAll(\".cell\")\n          .data(d)\n          .enter().append(\"rect\")\n          .attr(\"class\", \"cell\")\n          .attr(pos, function (d, i) {\n            return x(i);\n          })\n          .attr(\"width\", w)\n          .attr(\"height\", h)\n          .attr(\"title\", function (d) {\n            return d.id;\n          })\n          .style(\"fill\", function (d) {\n            return colormap(popNameFromId(d.id));\n          })\n          .style(\"stroke\", function (d) {\n            return colormap(popNameFromId(d.id));\n          })\n          .on(\"mouseover\", function (d) {\n            mouseoverCell.apply(this, [popNameFromId(d.id)])\n          })\n          .on(\"mouseout\", function () {\n            mouseoutCell.apply(this);\n          })\n      };\n    };\n\n    const rect = container\n      .append(\"rect\")\n      .attr(\"class\", \"background\")\n      .attr(\"width\", matrixDim)\n      .attr(\"height\", matrixDim);\n\n    const colormap = context.nodeColormap.range ? context.nodeColormap : d3.scaleOrdinal(d3.schemeCategory20);\n    const postMargin = parseInt(rect.attr(\"width\")) / pre.length;\n    const preMargin = parseInt(rect.attr(\"height\")) / post.length;\n\n    const postPop = container.selectAll(\".postPop\")\n      .data([post])\n      .enter()\n      .append(\"g\")\n      .attr(\"class\", \"postPop\")\n      .attr(\"transform\", \"translate(0,\" + -this.topIndicator + \")\")\n      .each(popIndicator(\"x\", colormap, postMargin, 5));\n    const prePop = container.selectAll(\".prePop\")\n      .data([pre])\n      .enter()\n      .append(\"g\")\n      .attr(\"class\", \"prePop\")\n      .attr(\"transform\", \"translate(\" + -this.leftIndicator + \",0)\")\n      .each(popIndicator(\"y\", colormap, 5, preMargin));\n\n    let row_ = container.selectAll(\".row\")\n      .data(matrix)\n      .enter().append(\"g\")\n      .attr(\"class\", \"row\")\n      .attr(\"transform\", function (d, i) {\n        return \"translate(0,\" + x(i) + \")\";\n      })\n      .each(row);\n\n    row_.append(\"line\")\n      .attr(\"x2\", context.width);\n\n    let column = container.selectAll(\".column\")\n      .data(matrix)\n      .enter().append(\"g\")\n      .attr(\"class\", \"column\")\n      .attr(\"transform\", function (d, i) {\n        return \"translate(\" + x(i) + \")rotate(-90)\";\n      });\n\n    column.append(\"line\")\n      .attr(\"x1\", -context.width);\n\n    // Draw squares for each connection\n    function row (row) {\n      const cell = d3.select(this).selectAll(\".cell\")\n        .data(row.filter(function (d) {\n          return d.z;\n        })) // only paint conns\n        .enter().append(\"rect\")\n        .attr(\"class\", \"cell\")\n        .attr(\"x\", function (d) {\n          return x(d.x);\n        })\n        .attr(\"width\", x.bandwidth())\n        .attr(\"height\", x.bandwidth())\n        .attr(\"title\", function (d) {\n          return d.id;\n        })\n      // .style(\"fill-opacity\", function(d) { return z(d.z); })\n        .style(\"fill\", function (d) {\n          return c(d.z);\n        })\n        .on(\"click\", function (d) {\n          context.props.matrixOnClickHandler();\n        })\n        .on(\"mouseover\", function (d) {\n          mouseoverCell.apply(this, [nodes[d.y].id + \" is connected to \" + nodes[d.x].id]);\n        })\n        .on(\"mouseout\", function () {\n          mouseoutCell.apply(this);\n        })\n    }\n  }\n\n  getLegends (context){\n    const colormap = context.nodeColormap.range ? context.nodeColormap : d3.scaleOrdinal(d3.schemeCategory20);\n    return [\n      { id:'legend', colorScale:colormap, title:null }\n    ];\n  }\n\n  getName (){\n    return \"Matrix\"\n  }\n\n  setOrder (context, value){\n    this.order = value;\n\n    const matrixDim\n        = context.height < context.width\n          ? context.height\n          : context.width;\n    \n    const x = d3.scaleBand().range([0, matrixDim]);\n\n    x.domain(this.orders[value]);\n\n    const t = context.svg.transition().duration(2500);\n    t.selectAll(\".row\")\n      .delay(function (d, i) {\n        return x(i) * 4;\n      })\n      .attr(\"transform\", function (d, i) {\n        return \"translate(0,\" + x(i) + \")\";\n      })\n      .selectAll(\".cell\")\n      .delay(function (d) {\n        return x(d.x) * 4;\n      })\n      .attr(\"x\", function (d) {\n        return x(d.x);\n      });\n\n    t.selectAll(\".postPop .cell\")\n      .delay(function (d, i) {\n        return x(i) * 4;\n      })\n      .attr(\"x\", function (d, i) {\n        return x(i);\n      });\n\n    t.selectAll(\".prePop .cell\")\n      .delay(function (d, i) {\n        return x(i) * 4;\n      })\n      .attr(\"y\", function (d, i) {\n        return x(i);\n      });\n\n    t.selectAll(\".column\")\n      .delay(function (d, i) {\n        return x(i) * 4;\n      })\n      .attr(\"transform\", function (d, i) {\n        return \"translate(\" + x(i) + \")rotate(-90)\";\n      });\n  }\n  \n  hasTooltip (){\n    return true\n  }\n\n  hasToggle (){\n    return true\n  }\n\n  hasSelect (){\n    return true\n  }\n}\n"],"mappings":"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","ignoreList":[]}