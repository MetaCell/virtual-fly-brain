{"version":3,"file":"instancedMesh.js","names":["AFRAME","registerComponent","schema","retainParent","retainChildren","inheritMat","mergeInstances","frustumCulled","init","update","_this","self","el","list","children","quantity","applyMatrix","position","THREE","Vector3","rotation","Euler","scale","quaternion","Quaternion","i","matrix","x","object3D","y","z","setFromEuler","compose","_iterator","_createForOfIteratorHelper","_step","s","n","done","item","value","err","e","f","mesh","getObject3D","addEventListener","call","data","material","clone","traverse","node","type","geometry","amesh","InstancedMesh","Matrix4","child","setMatrixAt","add","remove","components"],"sources":["../../../src/vr-canvas/aframe/instancedMesh.js"],"sourcesContent":["/* eslint-disable */\nAFRAME.registerComponent('instancedmesh', {\n  schema: {\n    retainParent: { default: false },\n    retainChildren: { default: false }, //Not yet implemented\n    inheritMat: { default: true },\n    mergeInstances: { default: false }, //Not yet implemented\n    frustumCulled: { default: true },\n  },\n\n  init: function () {},\n  update: function () {\n    var self = this;\n    var el = this.el;\n    var list = this.el.children;\n    var quantity = 0;\n\n    var applyMatrix = (function () {\n      var position = new THREE.Vector3();\n      var rotation = new THREE.Euler();\n      var scale = new THREE.Vector3();\n      var quaternion = new THREE.Quaternion();\n      return function (i, matrix) {\n        position.x = el.children[i].object3D.position.x;\n        position.y = el.children[i].object3D.position.y;\n        position.z = el.children[i].object3D.position.z;\n        rotation.x = el.children[i].object3D.rotation.x;\n        rotation.y = el.children[i].object3D.rotation.y;\n        rotation.z = el.children[i].object3D.rotation.z;\n        quaternion.setFromEuler(rotation);\n        scale.x = el.children[i].object3D.scale.x;\n        scale.y = el.children[i].object3D.scale.y;\n        scale.z = el.children[i].object3D.scale.z;\n        matrix.compose(position, quaternion, scale);\n      }; //High verbosity because imma N00b donÂ´t know how to access matrix on an uninitialized object\n    })();\n    for (var item of list) {\n      quantity = quantity + 1;\n    }\n    var mesh = this.el.getObject3D('mesh');\n    if (!mesh) {\n      this.el.addEventListener('model-loaded', (e) => {\n        this.update.call(this, this.data);\n      });\n      return;\n    }\n    var material = mesh.material.clone();\n\n    mesh.traverse(function (node) {\n      if (node.type != 'Mesh') return;\n      geometry = node.geometry;\n    });\n\n    var amesh = new THREE.InstancedMesh(geometry, material, quantity);\n\n    for (i = 0; i < quantity; i++) {\n      matrix = new THREE.Matrix4();\n      child = this.el.children[i];\n      applyMatrix(i, matrix);\n      amesh.setMatrixAt(i, matrix);\n    }\n    //frustumCulled\n    amesh.frustumCulled = this.data.frustumCulled;\n    this.el.object3D.add(amesh);\n    // retainParent\n    if (!self.data.retainParent) {\n      this.el.object3D.remove(mesh);\n    }\n    // inheritMat (Set material attribute to cloned material)\n    if (self.data.inheritMat) {\n      this.el.components.material.material = material;\n    }\n  },\n});\n"],"mappings":"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","ignoreList":[]}