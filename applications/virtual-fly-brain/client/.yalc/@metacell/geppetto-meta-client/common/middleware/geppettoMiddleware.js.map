{"version":3,"file":"geppettoMiddleware.js","names":["callbacksMiddleware","getState","dispatch","next","action","onError","payload","EventManager","geppettoError","message","onGeppettoVersion","version","geppettoVersion","Resources","GEPPETTO_VERSION_HOLDER","replace","console","log","actionTriggered","callbacksList","type","undefined","size","forEach","item","clientActions","PROJECT_LOAD_FROM_ID","MessageSocket","loadProjectFromId","data","PROJECT_LOAD_FROM_URL","loadProjectFromUrl","backendActions","GEPPETTO_VERSION","IMPORT_TYPE_RESOLVED","Manager","swapResolvedType","IMPORT_VALUE_RESOLVED","swapResolvedValue","FETCHED","VARIABLE_FETCHED","addVariableToModel","MODEL_LOADED","time","PARSING_MODEL","loadModel","PROJECT_LOADED","projectId","project","id","loadProject","persisted","ERROR_DOWNLOADING_MODEL","ERROR_DOWNLOADING_RESULTS","ERROR_LOADING_PROJECT","ERROR_LOADING_SIM","ERROR"],"sources":["../../../src/common/middleware/geppettoMiddleware.js"],"sourcesContent":["import Resources from '@metacell/geppetto-meta-core/Resources';\n\nimport { clientActions, backendActions } from '../actions';\nimport Manager from '../../common/GeppettoManager';\nimport EventManager, { callbacksList } from '../../common/EventManager';\nimport MessageSocket from '../../communication/MessageSocket';\n\nexport function callbacksMiddleware ({ getState, dispatch }) {\n  return function (next) {\n    return function (action) {\n\n\n      const onError = payload => {\n        EventManager.geppettoError(payload.message);\n      }\n\n\n      const onGeppettoVersion = payload => {\n        const version = payload;\n        const geppettoVersion = Resources.GEPPETTO_VERSION_HOLDER.replace(\"$1\", version);\n        console.log(geppettoVersion);\n      }\n\n      var actionTriggered = false;\n      if (callbacksList[action.type] !== undefined && callbacksList[action.type].size > 0) {\n        callbacksList[action.type].forEach(item => {\n          item(action);\n        });\n      }\n\n      switch (action.type) {\n      case clientActions.PROJECT_LOAD_FROM_ID:\n        MessageSocket.loadProjectFromId(action.data);\n        break;\n      case clientActions.PROJECT_LOAD_FROM_URL:\n        MessageSocket.loadProjectFromUrl(action.data);\n        break;\n      case backendActions.GEPPETTO_VERSION:\n        onGeppettoVersion(action.data);\n        break;\n      case backendActions.IMPORT_TYPE_RESOLVED:\n        Manager.swapResolvedType(action.data);\n        break;\n      case backendActions.IMPORT_VALUE_RESOLVED:\n        Manager.swapResolvedValue(action.data);\n        break; \n      case backendActions.FETCHED:\n      case backendActions.VARIABLE_FETCHED:{ \n        Manager.addVariableToModel(action.data);\n        break; \n      }\n      case backendActions.MODEL_LOADED: {\n        console.time(Resources.PARSING_MODEL);\n        Manager.loadModel(action.data);\n        break;\n      }\n      case backendActions.PROJECT_LOADED: {\n\n        const message = action.data;\n        MessageSocket.projectId = message.project.id;\n        Manager.loadProject(message.project, message.persisted);\n        break;\n      }\n\n      case backendActions.ERROR_DOWNLOADING_MODEL:\n      case backendActions.ERROR_DOWNLOADING_RESULTS:\n      case backendActions.ERROR_LOADING_PROJECT:\n      case backendActions.ERROR_LOADING_SIM:\n      case backendActions.ERROR:\n        onError(action.data);\n        break;\n      default:\n        break;\n      }\n\n      if (!actionTriggered) {\n        next(action);\n      }\n      return;\n    }\n  }\n}\n"],"mappings":"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"}