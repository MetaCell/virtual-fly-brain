{"version":3,"file":"FloatingWindow.js","names":["React","_interopRequireWildcard","require","_reactDom","_Types","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","o","minLen","_arrayLikeToArray","prototype","toString","slice","constructor","name","Array","from","test","len","length","arr2","l","Symbol","iterator","f","next","done","push","value","isArray","FloatingWindow","exports","props","title","id","url","rect","onCloseWindow","onSetWindow","children","popoutWindow","useRef","_React$useState","useState","undefined","_React$useState2","content","setContent","useLayoutEffect","current","window","open","concat","x","y","width","height","addEventListener","close","popoutDocument","document","popoutContent","createElement","className","CLASSES","FLEXLAYOUT__FLOATING_WINDOW_CONTENT","body","appendChild","copyStyles","then","console","warn","setTimeout","createPortal","doc","head","promises","styleSheets","forEach","styleSheet","href","styleElement","type","rel","Promise","resolve","reject","onload","rules","cssRules","style","cssRule","createTextNode","cssText","all"],"sources":["../../../../src/flex-layout/src/view/FloatingWindow.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { createPortal } from \"react-dom\";\nimport Rect from \"../Rect\";\nimport { CLASSES } from \"../Types\";\n\n/** @hidden @internal */\nexport interface IFloatingWindowProps {\n    title: string;\n    id: string;\n    url: string;\n    rect: Rect;\n    onCloseWindow: (id: string) => void;\n    onSetWindow: (id: string, window: Window) => void;\n}\n\n/** @hidden @internal */\nexport const FloatingWindow = (props: React.PropsWithChildren<IFloatingWindowProps>) => {\n    const { title, id, url, rect, onCloseWindow, onSetWindow, children } = props;\n    const popoutWindow = React.useRef<Window | null>(null);\n    const [content, setContent] = React.useState<HTMLElement | undefined>(undefined);\n\n    React.useLayoutEffect(() => {\n        const r = rect;\n        popoutWindow.current = window.open(url, id, `left=${r.x},top=${r.y},width=${r.width},height=${r.height}`);\n        if (popoutWindow.current !== null) {\n            onSetWindow(id, popoutWindow.current);\n\n            // listen for parent unloading to remove all popouts\n            window.addEventListener(\"beforeunload\", () => {\n                if (popoutWindow.current) {\n                    popoutWindow.current.close();\n                    popoutWindow.current = null;\n                }\n            });\n\n            popoutWindow.current.addEventListener(\"load\", () => {\n                const popoutDocument = popoutWindow.current!.document;\n                popoutDocument.title = title;\n                const popoutContent = popoutDocument.createElement(\"div\");\n                popoutContent.className = CLASSES.FLEXLAYOUT__FLOATING_WINDOW_CONTENT;\n                popoutDocument.body.appendChild(popoutContent);\n                copyStyles(popoutDocument).then(() => {\n                    setContent(popoutContent);\n                });\n\n                // listen for popout unloading (needs to be after load for safari)\n                popoutWindow.current!.addEventListener(\"beforeunload\", () => {\n                    onCloseWindow(id);\n                });\n            });\n        } else {\n            console.warn(`Unable to open window ${url}`);\n            onCloseWindow(id);\n        }\n\n        return () => {\n            // delay so refresh will close window\n            setTimeout(() => {\n                if (popoutWindow.current) {\n                    popoutWindow.current.close();\n                    popoutWindow.current = null;\n                }\n            }, 0);\n        };\n    }, []);\n\n    if (content !== undefined) {\n        return createPortal(children, content!);\n    } else {\n        return null;\n    }\n};\n\n/** @hidden @internal */\nfunction copyStyles(doc: Document): Promise<boolean[]> {\n    const head = doc.head;\n    const promises: Promise<boolean>[] = [];\n    Array.from(window.document.styleSheets).forEach((styleSheet) => {\n        if (styleSheet.href) {\n            // prefer links since they will keep paths to images etc\n            const styleElement = doc.createElement(\"link\");\n            styleElement.type = styleSheet.type;\n            styleElement.rel = \"stylesheet\";\n            styleElement.href = styleSheet.href!;\n            head.appendChild(styleElement);\n            promises.push(\n                new Promise((resolve, reject) => {\n                    styleElement.onload = () => resolve(true);\n                })\n            );\n        } else {\n            try {\n                const rules = styleSheet.cssRules;\n                const style = doc.createElement(\"style\");\n                Array.from(rules).forEach((cssRule) => {\n                    style.appendChild(doc.createTextNode(cssRule.cssText));\n                });\n                head.appendChild(style);\n            } catch (e) {\n                // styleSheet.cssRules can thro security exception\n            }\n        }\n    });\n    return Promise.all(promises);\n}\n"],"mappings":"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","ignoreList":[]}