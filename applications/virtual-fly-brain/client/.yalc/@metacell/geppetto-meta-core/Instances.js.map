{"version":3,"file":"Instances.js","names":["augmentInstancesArray","instances","i","length","window","getId","Instances","addInstances","instancePaths","constructor","Array","ModelFactory","Model","getInstance","instancePath","create","override","undefined","InstanceVarName","arrayParameter","j","indexOf","arrayPath","substring","subArrayPath","arrayInstance","arraySize","getSize","splice","x","push","potentialVar","eval","deleteInstance","e"],"sources":["../src/Instances.js"],"sourcesContent":["/**\n * Client class use to handle Geppetto workflows\n *\n * @module Manager\n * @author Matteo Cantarelli\n */\n\n\nimport ModelFactory from './ModelFactory';\n\n\n/**\n * Augments the instances array with some utilities methods for ease of access\n */\nexport function augmentInstancesArray (instances) {\n  // create global shortcuts to top level instances\n  for (var i = 0; i < instances.length; i++) {\n    // NOTE: tampering with the window object like this is probably a horrible idea\n    window[instances[i].getId()] = instances[i];\n    window.Instances[instances[i].getId()] = instances[i];\n  }\n\n  // add method to add instances to window.Instances\n  instances.addInstances = function (instancePaths) {\n    if (!(instancePaths.constructor === Array)) {\n      // if it's not an array throw it into an array with a single element\n      instancePaths = [instancePaths];\n    }\n\n    ModelFactory.addInstances(instancePaths, window.Instances, window.Model);\n  };\n\n  instances.getInstance = function (instancePath, create, override) {\n    if (create == undefined) {\n      create = true;\n    }\n\n    var instances = [];\n    var InstanceVarName = \"Instances.\";\n    var arrayParameter = true;\n\n    if (!(instancePath.constructor === Array)) {\n      instancePath = [instancePath];\n      arrayParameter = false;\n    }\n\n    // check if we have any [*] for array notation and replace with exploded paths\n    for (var j = 0; j < instancePath.length; j++) {\n      if (instancePath[j].indexOf('[*]') > -1) {\n        var arrayPath = instancePath[j].substring(0, instancePath[j].indexOf('['));\n        var subArrayPath = instancePath[j].substring(instancePath[j].indexOf(']') + 1, instancePath[j].length);\n        var arrayInstance = Instances.getInstance(arrayPath);\n        var arraySize = arrayInstance.getSize();\n\n        // remove original * entry\n        instancePath.splice(j, 1);\n        // add exploded elements\n        for (var x = 0; x < arraySize; x++) {\n          instancePath.push(arrayPath + '[' + x + ']' + subArrayPath);\n        }\n      }\n    }\n\n\n    for (var i = 0; i < instancePath.length; i++) {\n      try {\n        var potentialVar = eval(InstanceVarName + instancePath[i]);\n        if (potentialVar != undefined) {\n          if (override) {\n            ModelFactory.deleteInstance(instances[i]);\n            Instances.addInstances(instancePath[i]);\n            instances.push(eval(InstanceVarName + instancePath[i]));\n          } else {\n            instances.push(potentialVar);\n          }\n        } else {\n          if (create) {\n            Instances.addInstances(instancePath[i]);\n            instances.push(eval(InstanceVarName + instancePath[i]));\n          }\n        }\n      } catch (e) {\n        if (create) {\n          try {\n\n            Instances.addInstances(instancePath[i]);\n            instances[i] = eval(InstanceVarName + instancePath[i]);\n          } catch (e) {\n            throw (\"The instance \" + instancePath[i] + \" does not exist in the current model\");\n          }\n        }\n      }\n    }\n\n    if (instances.length == 1 && !arrayParameter) {\n      // if we received an array we want to return an array even if there's only one element\n      return instances[0];\n    } else {\n      return instances;\n    }\n  }\n      \n}\n\nexport default { augmentInstancesArray }"],"mappings":"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"}